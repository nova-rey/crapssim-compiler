<script type="text/html" data-template-name="bet-prop">
  <div class="form-row">
    <label for="node-input-propKind"><i class="fa fa-diamond"></i> Prop kind</label>
    <select id="node-input-propKind">
      <option value="Hardway">Hardway</option>
      <option value="Any7">Any7</option>
      <option value="AnyCraps">AnyCraps</option>
      <option value="Yo11">Yo11</option>
      <option value="Aces">Aces</option>
      <option value="Boxcars">Boxcars</option>
      <option value="AceDeuce">AceDeuce</option>
      <option value="Horn">Horn</option>
      <option value="HornHigh">HornHigh</option>
      <option value="Hop">Hop</option>
      <option value="Prop">Prop</option>
    </select>
  </div>

  <div class="form-row hardway-only">
    <label for="node-input-number"><i class="fa fa-hashtag"></i> Number</label>
    <input type="number" id="node-input-number" placeholder="4,6,8,10 (Hardway only)">
  </div>

  <div class="form-row">
    <label for="node-input-betId"><i class="fa fa-tag"></i> Bet ID</label>
    <input type="text" id="node-input-betId" placeholder="e.g. hard8 (optional)">
  </div>

  <hr>

  <div class="form-row">
    <label for="node-input-valueSource"><i class="fa fa-sliders"></i> Value Source</label>
    <select id="node-input-valueSource">
      <option value="fixed">fixed (enter amount here)</option>
      <option value="feed">feed (from bet-in / vars)</option>
    </select>
  </div>

  <div class="form-row node-fixed-only">
    <label for="node-input-amount"><i class="fa fa-dollar"></i> Amount</label>
    <input type="number" id="node-input-amount" min="0" value="0">
  </div>

  <div class="form-row node-fixed-only">
    <label for="node-input-unitType"><i class="fa fa-balance-scale"></i> Units</label>
    <select id="node-input-unitType">
      <option value="units">units</option>
      <option value="dollars">dollars</option>
    </select>
  </div>

  <div class="form-row">
    <label for="node-input-note"><i class="fa fa-sticky-note"></i> Note</label>
    <input type="text" id="node-input-note" placeholder="optional (e.g., hop combination)">
  </div>
</script>

<script type="text/html" data-help-name="bet-prop">
  <p>Prop family. Hardway supports numbers (4/6/8/10). Others are one-roll props. Choose <b>fixed</b> or <b>feed</b> for amounts.</p>
</script>

<script type="text/javascript">
  (function(){
    function toggleHardway() {
      const k = $("#node-input-propKind").val();
      const show = (k === "Hardway");
      $(".hardway-only")[show ? "show" : "hide"]();
    }
    function toggleFixedFields() {
      const v = $("#node-input-valueSource").val();
      const show = (v === "fixed");
      $(".node-fixed-only")[show ? "show" : "hide"]();
    }
    RED.nodes.registerType("bet-prop", {
      category: "craps",
      color: "#E9F0FF",
      icon: "font-awesome/fa-bolt",
      defaults: {
        propKind:    { value: "Hardway", required: true },
        number:      { value: "" },
        betId:       { value: "" },
        valueSource: { value: "fixed", required: true },
        amount:      { value: 0 },
        unitType:    { value: "units" },
        note:        { value: "" }
      },
      inputs: 1,
      outputs: 1,
      oneditprepare: function(){
        $("#node-input-propKind").on("change", toggleHardway);
        $("#node-input-valueSource").on("change", toggleFixedFields);
        toggleHardway();
        toggleFixedFields();
      },
      label: function() {
        const n  = (this.propKind === "Hardway" && this.number) ? ` ${this.number}` : "";
        const vs = this.valueSource === "fixed" ? ` ${this.amount} ${this.unitType}` : " (feed)";
        return `${this.propKind}${n}${vs}`;
      }
    });
  })();
</script>
