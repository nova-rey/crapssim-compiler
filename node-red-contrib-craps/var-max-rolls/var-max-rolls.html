<script type="text/html" data-template-name="var-max-rolls">
  <div class="form-row">
    <label for="node-input-mode"><i class="fa fa-sliders"></i> Mode</label>
    <select id="node-input-mode">
      <option value="infinite">infinite</option>
      <option value="fixed">fixed</option>
    </select>
  </div>
  <div class="form-row fixed-only">
    <label for="node-input-value"><i class="fa fa-hashtag"></i> Max rolls</label>
    <input type="number" id="node-input-value" min="1" value="200">
  </div>
  <div class="form-row">
    <label for="node-input-note"><i class="fa fa-sticky-note"></i> Note</label>
    <input type="text" id="node-input-note" placeholder="optional">
  </div>
</script>

<script type="text/html" data-help-name="var-max-rolls">
  <p>Sets <code>msg.sim.max_rolls</code> for the exporter.</p>
  <ul>
    <li><b>infinite</b> → exporter writes <code>max_rolls=float("inf")</code></li>
    <li><b>fixed</b> → exporter writes <code>max_rolls=&lt;value&gt;</code></li>
  </ul>
</script>

<script type="text/javascript">
  (function(){
    function toggleFixed(){
      const show = $("#node-input-mode").val()==="fixed";
      $(".fixed-only")[show ? "show" : "hide"]();
    }
    RED.nodes.registerType("var-max-rolls", {
      category: "craps",
      color: "#EFF7FF",
      icon: "font-awesome/fa-repeat",
      defaults: {
        mode:  { value: "infinite", required: true },
        value: { value: 200 },
        note:  { value: "" }
      },
      inputs: 1,
      outputs: 1,
      oneditprepare: function(){
        $("#node-input-mode").on("change", toggleFixed);
        toggleFixed();
      },
      label: function(){
        return this.mode === "fixed" ? `max-rolls=${this.value}` : "max-rolls=∞";
      }
    });
  })();
</script>
